/* SmartTab plugin v2.0
 * jQuery Tab Control Plugin
 * http://techlaboratory.net/smarttab
 * 
 * by Dipu Raj  
 * http://dipuraj.me
 * 
 * License 
 * https://github.com/techlab/SmartTab/blob/master/MIT-LICENSE.txt 
 */
 
(function(a){a.fn.smartTab=function(d){var c=a.extend({},a.fn.smartTab.defaults,d);var b=arguments;return this.each(function(){var o=a(this);var i=a("ul:first",o),y=a("li > a",i),w=a(".stContainer",o);if(!o.data("options")){o.data("options",c)}else{c=o.data("options")}if(!d||d==="init"||typeof d==="object"){t()}else{if(d==="showTab"){var r=Array.prototype.slice.call(b,1);if(r[0]==o.data("curTabIdx")){return false}n(r[0]);return true}else{a.error("Method "+d+" does not exist")}}function t(){a(o).addClass("stMain");a(i).addClass("tabAnchor");h();u();var E=c.selected;if(c.saveState){var F=f();if(F){E=F}}E=(E)?E:0;n(E)}function h(){if(w.length==0){w=a("<div></div>").addClass("stContainer");a(o).append(w)}a(y).each(function(){var E=a(a(this).attr("href"),o);E.addClass("tabContent").hide();w.append(E)})}function u(){a(y).bind("click",function(E){E.preventDefault();if(y.index(this)!=o.data("curTabIdx")){n(y.index(this));if(c.autoProgress){v()}}});if(c.keyNavigation){a(document).keyup(function(E){if(E.which==39){j();if(c.autoProgress){v()}}else{if(E.which==37){k();if(c.autoProgress){v()}}}})}if(c.autoProgress){if(c.stopOnFocus){a(o).bind("mouseover",function(E){C();return true});a(o).bind("mouseleave",function(E){m();return true})}m()}}function n(E){if(o.data("isAnimating")){return false}if(c.contentURL&&c.contentURL.length>0){s(E)}else{x(E)}}function s(F){var G=y.eq(F);if(c.contentCache&&G.data("hasContent")){x(F)}else{var E=a("<div>Loading</div>").addClass("loader");if(c.autoProgress){C()}a(o).append(E);a.ajax({url:c.contentURL,type:"POST",data:({tab_index:F}),dataType:"text",beforeSend:function(){E.show()},error:function(){E.hide().remove()},success:function(H){if(H&&H.length>0){a(G.attr("href"),o).html(H);G.data("hasContent",true);x(F);if(c.autoProgress){v()}}E.hide().remove()}})}}function x(O){if(o.data("isAnimating")){return false}var M=y.eq(o.data("curTabIdx"));var K=y.eq(O);o.data("isAnimating",true);c.transitionEffect=c.transitionEffect.toLowerCase();if(a.isFunction(c.onLeaveTab)){if(!c.onLeaveTab.call(this,a(M))){return false}}if(c.transitionEffect=="hslide"){var Q,I,N,F,G=w.width();if(O>o.data("curTabIdx")){Q=0;I=(G+10)*-1;N=(G+10);F=0}else{Q=0;I=(G+10);N=(G*-2)+10;F=0}if(M.length>0){a(M.attr("href"),o).css("left",Q).animate({left:I},c.transitionSpeed,c.transitionEasing,function(T){a(this).hide()})}a(K.attr("href"),o).css("left",N).width(G).show().animate({left:F},c.transitionSpeed,c.transitionEasing,function(T){a(this).show();A(O,M,K)})}else{if(c.transitionEffect=="vslide"){var P,H,J,R,L=w.height();var E=a(M.attr("href"),o);var S=a(K.attr("href"),o);if(O>o.data("curTabIdx")){P=0;H=(E.height()+10)*-1;J=(S.height()+10);R=0}else{P=0;H=(E.height()+10);J=(S.height()*-2)+10;R=0}if(M.length>0){E.css("top",P).animate({top:H},c.transitionSpeed,c.transitionEasing,function(T){E.hide()})}S.css("top",J).show().animate({top:R},c.transitionSpeed,c.transitionEasing,function(T){a(this).show();A(O,M,K)})}else{if(c.transitionEffect=="slide"){if(M.length>0){a(M.attr("href"),o).slideUp(c.transitionSpeed,c.transitionEasing,function(){a(K.attr("href"),o).slideDown(c.transitionSpeed,c.transitionEasing,function(){A(O,M,K)})})}else{a(K.attr("href"),o).slideDown(c.transitionSpeed,c.transitionEasing,function(){a(this).show();A(O,M,K)})}}else{if(c.transitionEffect=="fade"){a(a(M).attr("href"),o).fadeOut(c.transitionSpeed,c.transitionEasing,function(){a(a(K).attr("href"),o).fadeIn(c.transitionSpeed,c.transitionEasing);a(this).show();A(O,M,K)})}else{if(M.length>0){a(M.attr("href"),o).hide()}a(K.attr("href"),o).show();A(O,M,K)}}}}return true}function g(E){if(c.autoHeight){w.animate({height:a(E.attr("href")).height()},c.transitionSpeed)}}function A(F,E,G){E.removeClass("sel");G.addClass("sel");o.data("curTabIdx",F);o.data("isAnimating",false);if(c.saveState){B(F)}g(G);if(a.isFunction(c.onShowTab)){if(!c.onShowTab.call(this,a(G))){return false}}return true}function m(){if(!o.data("autoProgressId")){o.data("autoProgressId",setInterval(j,c.progressInterval))}}function v(){C();m()}function C(){if(o.data("autoProgressId")){clearInterval(o.data("autoProgressId"));o.data("autoProgressId",null)}}function j(){var E=(o.data("curTabIdx")-0)+1;if(y.length<=E){E=0}n(E)}function k(){var E=(o.data("curTabIdx")-0)-1;if(0>E){E=y.length-1}n(E)}function B(E){var F="stCurrentTab"+o.attr("id");if(l()){return p(F,E)}else{return q(F,E)}}function f(){var E="stCurrentTab"+o.attr("id");if(l()){return z(E)}else{return e(E)}}function l(){if(localStorage&&typeof(localStorage)!="undefined"){return true}return false}function p(E,F){try{localStorage.setItem(E,F);return true}catch(G){return false}}function z(E){try{if(localStorage&&localStorage.getItem(E)){return localStorage.getItem(E)}return false}catch(F){return false}}function q(G,H){var F=new Date();F.setTime(F.getTime()+(1*24*60*60*1000));var E="; expires="+F.toGMTString();document.cookie=G+"="+H+E+"; path=/"}function e(F){F+="=";var E=document.cookie.split(";");for(var G=0;G<E.length;G++){var H=E[G];while(H.charAt(0)==" "){H=H.substring(1,H.length)}if(H.indexOf(F)==0){return H.substring(F.length,H.length)}}return null}function D(E){q(E,"",-1)}})};a.extend(a.easing,{def:"easeOutQuad",swing:function(f,g,e,i,h){return a.easing[a.easing.def](f,g,e,i,h)},easeOutQuad:function(f,g,e,i,h){return -i*(g/=h)*(g-2)+e},easeOutQuart:function(f,g,e,i,h){return -i*((g=g/h-1)*g*g*g-1)+e},easeOutQuint:function(f,g,e,i,h){return i*((g=g/h-1)*g*g*g*g+1)+e},easeInOutExpo:function(f,g,e,i,h){if(g==0){return e}if(g==h){return e+i}if((g/=h/2)<1){return i/2*Math.pow(2,10*(g-1))+e}return i/2*(-Math.pow(2,-10*--g)+2)+e},easeInOutElastic:function(f,h,e,l,k){var i=1.70158;var j=0;var g=l;if(h==0){return e}if((h/=k/2)==2){return e+l}if(!j){j=k*(0.3*1.5)}if(g<Math.abs(l)){g=l;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(l/g)}if(h<1){return -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e}return g*Math.pow(2,-10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+l+e},easeInOutBack:function(f,g,e,j,i,h){if(h==undefined){h=1.70158}if((g/=i/2)<1){return j/2*(g*g*(((h*=(1.525))+1)*g-h))+e}return j/2*((g-=2)*g*(((h*=(1.525))+1)*g+h)+2)+e}});a.fn.smartTab.defaults={selected:0,saveState:true,contentURL:null,contentCache:true,keyNavigation:true,autoProgress:false,progressInterval:3500,stopOnFocus:false,transitionEffect:"none",transitionSpeed:"400",transitionEasing:"easeInOutExpo",autoHeight:true,onLeaveTab:null,onShowTab:null}})(jQuery);